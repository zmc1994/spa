var appUnlogin = angular.module('qmgj_unlogin', ['ui.router']);
appUnlogin.config(["$stateProvider", "$urlRouterProvider", function($stateProvider, $urlRouterProvider) {
    $urlRouterProvider.otherwise('/login');
    $stateProvider
        .state('login', {
            url: '/login',
            templateUrl: '/static/app/view/login.html',
            controller: 'loginController'
        })
        .state('reg', {
            url: '/reg',
            templateUrl: '/static/app/view/reg.html',
            controller: 'regController'
        })
        .state('home', {
            url: '/home',
            templateUrl: '/static/app/view/home.html',
            controller: 'homeController'
        })

}]);
var appLogin = angular.module('qmgj_login', ['ui.router']);
appLogin.config(["$stateProvider", "$urlRouterProvider", function($stateProvider, $urlRouterProvider) {
    $urlRouterProvider.otherwise('/home');
    $stateProvider
        .state('home', {
            url: '/home',
            templateUrl: '/static/app/view/home.html',
            controller: 'homeController'
        })
}]);

function homeControllerFn($scope, $interval) {
    $scope.slideImg = [{
        proImg: 'static/app/images/slide1.jpg',
        proId: '1'
    }, {
        proImg: 'static/app/images/slide2.jpg',
        proId: '2'
    }];
    $scope.showIndex = 0;
    var inter = $interval(function() {
        if ($scope.showIndex >= $scope.slideImg.length - 1) {
            $scope.showIndex = 0;
            return;
        }
        $scope.showIndex++;
    }, 3500);

    $scope.showCurrentFn = function(i) {
            $scope.showIndex = i;
            // 销毁定时器
            $interval.cancel(inter);
            // 重新定义定时器
            inter = $interval(function() {
                if ($scope.showIndex >= $scope.slideImg.length - 1) {
                    $scope.showIndex = 0;
                    return;
                }
                $scope.showIndex++;
            }, 3500);
        }
        /*
        ['微电影','话剧','电影']
         */
    var hotPro = [{
        imgSrc: 'static/app/images/hot1.jpg',
        proName: '《晚秋》再现江湖',
        proCon: '蓝宝公司劳斯莱斯',
        proInfo: '超模明星足球队授权电影制作公司超模明星足球队授权电影制作公司超模明星足球队授权电影制作公司超模明星足球队授权电影制作公司',
        proType: 1,
        proProcess: '46%',
        proMoney: '1234',
        proPeople: '123',
        proDays: '12'
    }, {
        imgSrc: 'static/app/images/hot1.jpg',
        proName: '《封神传奇》再现江湖',
        proCon: '中国星',
        proInfo: '超模明星足球队授权电影制作公司超模明星足球队授权电影制作公司超模明星足球队授权电影制作公司超模明星足球队授权电影制作公司',
        proType: 2,
        proProcess: '12%',
        proMoney: '3789',
        proPeople: '323',
        proDays: '22'
    }, {
        imgSrc: 'static/app/images/hot1.jpg',
        proName: '《超脑特工》再现江湖',
        proCon: '东印度',
        proInfo: '超模明星足球队授权电影制作公司超模明星足球队授权电影制作公司超模明星足球队授权电影制作公司超模明星足球队授权电影制作公司',
        proType: 0,
        proProcess: '50%',
        proMoney: '1423',
        proPeople: '1223',
        proDays: '5'
    }];
    $scope.prosType = ['微电影', '话剧', '电影'];
    $scope.showPro = hotPro[1];
    $scope.showProIndex = $scope.showPro.proType;
    $scope.showProFn = function(i) {
        $scope.showProIndex = i;
        for (var j = 0; j < hotPro.length; j++) {
            if (hotPro[j].proType == i) {
                $scope.showPro = hotPro[j];
                break;
            }
        }
    }
}
appLogin.controller('homeController', ['$scope', '$interval', homeControllerFn]);
appUnlogin.controller('homeController', ['$scope', '$interval', homeControllerFn]);

appUnlogin.controller('loginController',['$scope','$http',function($scope,$http){
	$scope.userLogin = function(){
		if( $scope.loginForm.$valid ){
			// post请求
			$http({
				url: '/user/login',
				method: 'post',
				data: {
					phone: $scope.phone,
					password: $scope.pwd
				}
			}).success(function(res){
				if( res.resultCode == '0000' ){
					location.reload()
				}
			});
		}
	}
}]);
appUnlogin.controller('regController',["$scope","$http","$state",function($scope,$http,$state){
	$scope.userReg = function(flag){
		if( flag ){
			$http({
				url:'/user/reg',
				method: 'post',
				data: {
					name: $scope.username,
					phone: $scope.phone,
					password: $scope.pwd,
					passwordRepeat: $scope.pwd2
				}
			}).success(function(res){
				if(res.resultCode == '0000'){
					alert('注册成功，请登录');
					$state.go('login');
				}else{
					alert( res.resultMsg );
				}
			});
		}
	}
}])
appLogin.controller('userController',['$scope','$http',function($scope,$http){
	$scope.userLogout = function(){
		$http({
			url: '/user/logout'
		}).success(function (res){
			if( res.resultCode == '0000' ){
				location.reload();
			}
		});
	}
}]);